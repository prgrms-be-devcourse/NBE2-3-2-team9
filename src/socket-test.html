<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>

<h2>ğŸ”Œ WebSocket ì—°ê²° ìƒíƒœ í™•ì¸</h2>

<button onclick="connect()">ğŸ”— ì—°ê²°í•˜ê¸°</button>

<div id="status">ìƒíƒœ: ì—°ê²°ë˜ì§€ ì•ŠìŒ</div>

<script>
    let stompClient = null;

    // âœ… ìƒˆë¡œ ë°œê¸‰ë°›ì€ JWT í† í°ì„ ì…ë ¥
    const jwtToken = "Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiaWF0IjoxNzM3MTk2MjUyLCJleHAiOjE3MzcxOTk4NTJ9.CUmHxbPPU77l5yjamcwne02_OrdYCkBPWfPpxVzSEM8";

    // WebSocket ì—°ê²°
    function connect() {
        const socket = new SockJS('http://localhost:8080/chat-socket');
        stompClient = Stomp.over(socket);

        // âœ… JWT í† í°ì„ Authorization í—¤ë”ì— ì¶”ê°€
        stompClient.connect(
            { Authorization: jwtToken },
            function (frame) {
                document.getElementById('status').innerText = 'ìƒíƒœ: ì—°ê²°ë¨ âœ…';
                console.log('Connected: ' + frame);

                // âœ… êµ¬ë… ê²½ë¡œ í™•ì¸
                stompClient.subscribe('/topic/test', function (message) {
                    showMessage(message.body);
                });
            },
            function (error) {
                document.getElementById('status').innerText = 'ìƒíƒœ: ì—°ê²° ì‹¤íŒ¨ âŒ';
                console.error('ì—°ê²° ì‹¤íŒ¨:', error);
            }
        );
    }
</script>

</body>
</html>
